<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å…¬èªä¼šè¨ˆå£«è©¦é¨“ åå·®å€¤è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <style>
    body {
      font-family: 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 420px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      padding: 1.5rem;
    }
    h1 {
      font-size: 1.3rem;
      text-align: center;
      margin-bottom: 1.2rem;
    }
    label {
      display: block;
      margin-bottom: 0.2rem;
      font-size: 1rem;
    }
    input[type="number"], select {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 0.8rem;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
      margin-bottom: 1rem;
    }
    button:active {
      background: #0056b3;
    }
    .result {
      text-align: center;
      margin: 1.2rem 0 0.5rem 0;
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
    }
    .card {
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.2rem;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .card-title {
      font-weight: bold;
      font-size: 1.08rem;
      margin-bottom: 0.7rem;
      color: #1a237e;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .menjo-label {
      font-weight: normal;
      font-size: 0.98rem;
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.2em;
    }
    .menjo-message {
      color: #2e7d32;
      font-size: 1.3rem;
      margin-bottom: 0.7rem;
      text-align: left;
      font-weight: bold;
      text-align: center;
    }
    .card.kanri {
      background: #fff7e0;
      /* ã‚ªãƒ¬ãƒ³ã‚¸å¯„ã‚Šã®é»„è‰² */
    }
    .card.kansa {
      background: #e0f4ff;
      /* æ°´è‰² */
    }
    .card.hou {
      background: #fffde0;
      /* é»„è‰² */
    }
    .card.sozei {
      background: #f3e0ff;
      /* ç´«è‰² */
    }
    .card.sentaku {
      background: #e0ffe0;
      /* ç·‘è‰² */
    }
    .card.zaimu {
      background: #e3f0ff;
      /* é’è‰² */
    }
    @media (max-width: 600px) {
      .container {
        margin: 0.5rem;
        padding: 1rem;
      }
      h1 {
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å…¬èªä¼šè¨ˆå£«è©¦é¨“ åå·®å€¤è¨ˆç®—</h1>
    <p style="text-align:center;">å„ç§‘ç›®ã®åå·®å€¤ã‚’å…¥åŠ›ã—ã€è¨ˆç®—ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    <p style="text-align:center;">â€»åå·®å€¤ã¯åŠè§’æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
    <form id="hensachiForm" autocomplete="off">
      <div class="card zaimu">
        <div class="card-title">è²¡å‹™ä¼šè¨ˆè«–
          <label class="menjo-label"><input type="checkbox" id="menjo-zaimu">å…é™¤</label>
        </div>
        <div class="menjo-message" id="menjo-msg-zaimu" style="display:none;">å…é™¤</div>
        <label for="zaimu">åå·®å€¤</label>
        <input type="number" id="zaimu" name="zaimu" min="0" max="100" inputmode="decimal" placeholder="åå·®å€¤ã‚’å…¥åŠ›">
      </div>
      <div class="card kanri">
        <div class="card-title">ç®¡ç†ä¼šè¨ˆè«–
          <label class="menjo-label"><input type="checkbox" id="menjo-kanri">å…é™¤</label>
        </div>
        <div class="menjo-message" id="menjo-msg-kanri" style="display:none;">å…é™¤</div>
        <label for="kanri">åå·®å€¤</label>
        <input type="number" id="kanri" name="kanri" min="0" max="100" inputmode="decimal" placeholder="åå·®å€¤ã‚’å…¥åŠ›">
      </div>
      <div class="card kansa">
        <div class="card-title">ç›£æŸ»è«–
          <label class="menjo-label"><input type="checkbox" id="menjo-kansa">å…é™¤</label>
        </div>
        <div class="menjo-message" id="menjo-msg-kansa" style="display:none;">å…é™¤</div>
        <label for="kansa">åå·®å€¤</label>
        <input type="number" id="kansa" name="kansa" min="0" max="100" inputmode="decimal" placeholder="åå·®å€¤ã‚’å…¥åŠ›">
      </div>
      <div class="card hou">
        <div class="card-title">ä¼æ¥­æ³•
          <label class="menjo-label"><input type="checkbox" id="menjo-hou">å…é™¤</label>
        </div>
        <div class="menjo-message" id="menjo-msg-hou" style="display:none;">å…é™¤</div>
        <label for="hou">åå·®å€¤</label>
        <input type="number" id="hou" name="hou" min="0" max="100" inputmode="decimal" placeholder="åå·®å€¤ã‚’å…¥åŠ›">
      </div>
      <div class="card sozei">
        <div class="card-title">ç§Ÿç¨æ³•
          <label class="menjo-label"><input type="checkbox" id="menjo-sozei">å…é™¤</label>
        </div>
        <div class="menjo-message" id="menjo-msg-sozei" style="display:none;">å…é™¤</div>
        <label for="sozei">åå·®å€¤</label>
        <input type="number" id="sozei" name="sozei" min="0" max="100" inputmode="decimal" placeholder="åå·®å€¤ã‚’å…¥åŠ›">
      </div>
      <div class="card sentaku">
        <div class="card-title">é¸æŠç§‘ç›®ï¼ˆçµŒå–¶å­¦ï¼‰
          <label class="menjo-label"><input type="checkbox" id="menjo-sentaku">å…é™¤</label>
        </div>
        <div class="menjo-message" id="menjo-msg-sentaku" style="display:none;">å…é™¤</div>
        <label for="sentaku">åå·®å€¤</label>
        <input type="number" id="sentaku" name="sentaku" min="0" max="100" inputmode="decimal" placeholder="åå·®å€¤ã‚’å…¥åŠ›">
      </div>
      <button type="button" id="calcBtn">è¨ˆç®—ã™ã‚‹</button>
    </form>
    <div class="result" id="result"></div>
    <canvas id="radarChart" style="max-width:100%;"></canvas>
    <button type="button" id="tweetBtn" style="width:100%;background:#1da1f2;color:#fff;font-weight:bold;border:none;border-radius:6px;padding:0.7rem 0;margin-bottom:1.2rem;cursor:pointer;display:none;">çµæœã‚’Xã§ã‚·ã‚§ã‚¢</button>
  </div>
  <script type="module">
    import { calcHensachi } from './hensachi-calc.js';
    let chart = null;

    function getNum(id) {
      const v = document.getElementById(id).value;
      return v === '' || isNaN(Number(v)) ? null : Number(v);
    }

    // å…¨è§’æ•°å­—ãƒã‚§ãƒƒã‚¯ç”¨é–¢æ•°
    function containsZenkakuNumber(str) {
      return /[ï¼-ï¼™]/.test(str);
    }

    document.getElementById('calcBtn').addEventListener('click', function() {
      // å…¥åŠ›æ¬„ã‚’ã™ã¹ã¦å–å¾—
      const inputIds = [
        'zaimu',
        'kanri',
        'kansa',
        'hou',
        'sozei',
        'sentaku'
      ];
      for (const id of inputIds) {
        const val = document.getElementById(id).value;
        if (containsZenkakuNumber(val)) {
          document.getElementById('result').textContent = 'åå·®å€¤ã¯åŠè§’æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
          if (chart) chart.destroy();
          document.getElementById('tweetBtn').style.display = 'none';
          return;
        }
      }

      // å…¥åŠ›å€¤ãŒæœªå…¥åŠ›ã®ç§‘ç›®ãŒã‚ã‚Œã°ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
      let emptyInput = false;
      for (const id of inputIds) {
        const menjoId = id.replace(/^(zaimu|kanri|kansa|hou|sozei|sentaku)$/, 'menjo-$1');
        const isMenjo = document.getElementById(menjoId).checked;
        const val = document.getElementById(id).value;
        if (!isMenjo && (val === '' || isNaN(Number(val)))) {
          emptyInput = true;
          break;
        }
      }
      if (emptyInput) {
        document.getElementById('result').textContent = 'åå·®å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
        if (chart) chart.destroy();
        document.getElementById('tweetBtn').style.display = 'none';
        return;
      }
      for (const id of inputIds) {
        const val = document.getElementById(id).value;
        if (containsZenkakuNumber(val)) {
          document.getElementById('result').textContent = 'åå·®å€¤ã¯åŠè§’æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
          if (chart) chart.destroy();
          document.getElementById('tweetBtn').style.display = 'none';
          return;
        }
      }

      // å…é™¤åˆ¤å®š
      const menjo = {
        zaimu: document.getElementById('menjo-zaimu').checked,
        kanri: document.getElementById('menjo-kanri').checked,
        kansa: document.getElementById('menjo-kansa').checked,
        hou: document.getElementById('menjo-hou').checked,
        sozei: document.getElementById('menjo-sozei').checked,
        sentaku: document.getElementById('menjo-sentaku').checked
      };

      // å„ç§‘ç›®ã®åå·®å€¤è¨ˆç®—
      let hensachi = {};
      if (!menjo.kanri) {
        const v = getNum('kanri');
        hensachi['ç®¡ç†ä¼šè¨ˆè«–'] = v !== null ? v : null;
      } else {
        hensachi['ç®¡ç†ä¼šè¨ˆè«–'] = null;
      }
      if (!menjo.zaimu) {
        const v = getNum('zaimu');
        hensachi['è²¡å‹™ä¼šè¨ˆè«–'] = v !== null ? v : null;
      } else {
        hensachi['è²¡å‹™ä¼šè¨ˆè«–'] = null;
      }
      if (!menjo.kansa) {
        const v = getNum('kansa');
        hensachi['ç›£æŸ»è«–'] = v !== null ? v : null;
      } else {
        hensachi['ç›£æŸ»è«–'] = null;
      }
      if (!menjo.hou) {
        const v = getNum('hou');
        hensachi['ä¼æ¥­æ³•'] = v !== null ? v : null;
      } else {
        hensachi['ä¼æ¥­æ³•'] = null;
      }
      if (!menjo.sozei) {
        const v = getNum('sozei');
        hensachi['ç§Ÿç¨æ³•'] = v !== null ? v : null;
      } else {
        hensachi['ç§Ÿç¨æ³•'] = null;
      }
      if (!menjo.sentaku) {
        const v = getNum('sentaku');
        hensachi['çµŒå–¶å­¦'] = v !== null ? v : null;
      } else {
        hensachi['çµŒå–¶å­¦'] = null;
      }

      // ç·åˆåå·®å€¤è¨ˆç®—
      let kanri = hensachi['ç®¡ç†ä¼šè¨ˆè«–'];
      let zaimu = hensachi['è²¡å‹™ä¼šè¨ˆè«–'];
      let kansa = hensachi['ç›£æŸ»è«–'];
      let hou = hensachi['ä¼æ¥­æ³•'];
      let sozei = hensachi['ç§Ÿç¨æ³•'];
      let sentaku = hensachi['çµŒå–¶å­¦'];
      let sogo = null;
      let sogo_n = 0;
      let sogo_sum = 0;
      if (kanri !== null) { sogo_sum += kanri; sogo_n += 1; }
      if (zaimu !== null) { sogo_sum += zaimu*2; sogo_n += 2; }
      if (kansa !== null) { sogo_sum += kansa; sogo_n += 1; }
      if (hou !== null) { sogo_sum += hou; sogo_n += 1; }
      if (sozei !== null) { sogo_sum += sozei; sogo_n += 1; }
      if (sentaku !== null) { sogo_sum += sentaku; sogo_n += 1; }
      if (sogo_n > 0) {
        sogo = sogo_sum / sogo_n;
      }

      // è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ä½œæˆ
      const labels = [];
      const values = [];
      for (const key of ['ç®¡ç†ä¼šè¨ˆè«–','è²¡å‹™ä¼šè¨ˆè«–','ç›£æŸ»è«–','ä¼æ¥­æ³•','ç§Ÿç¨æ³•','çµŒå–¶å­¦']) {
        if (hensachi[key] !== null) {
          labels.push(key);
          values.push(Number(hensachi[key].toFixed(2)));
        }
      }
      let sogoLabel = '';
      let message = '';
      let tweetText = '';
      if (sogo !== null) {
        const totalHensachi = Number(sogo.toFixed(2));
        sogoLabel = `ç·åˆåå·®å€¤ï¼š${totalHensachi}`;
        if (totalHensachi >= 65) {
          message = "ã‚„ã‚‹ã‚„ã‚“ï¼å¤©æ‰çˆ†èª•ï¼ï¼ŸğŸ‰";
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ï¼ï¼Ÿã‚„ã‚‹ã‚„ã‚“ï¼å¤©æ‰çˆ†èª•ï¼ï¼Ÿ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 60) {
          message = "ã„ã„ã­ï¼ã“ã®ã¾ã¾çªã£èµ°ã‚Œï½ğŸ’¨";
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ï¼ã„ã„ã­ï¼ã“ã®ã¾ã¾çªã£èµ°ã‚Œï½ğŸ’¨ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 55) {
          message = "ã‚¸ãƒ¯ã‚¸ãƒ¯ãã¦ã‚‹ã€ãã®èª¿å­ğŸ”¥";
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ã€ã‚¸ãƒ¯ã‚¸ãƒ¯ãã¦ã‚‹ã€ãã®èª¿å­ğŸ”¥ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 52) {
          message = "ã‚‚ã†ã²ã¨ä¼¸ã³ï¼æ¬¡ã®è‡ªåˆ†ã«æœŸå¾…ğŸ˜";
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ï¼ã‚‚ã†ã²ã¨ä¼¸ã³ï¼æ¬¡ã®è‡ªåˆ†ã«æœŸå¾…ğŸ˜ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 50) {
          message = "ãŠã—ã„ï¼ã‚ã¨ã¡ã‚‡ã£ã¨ã§ã‚¾ãƒ¼ãƒ³çªå…¥ğŸš€";
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ã€ãŠã—ã„ï¼ã‚ã¨ã¡ã‚‡ã£ã¨ã§ã‚¾ãƒ¼ãƒ³çªå…¥ğŸš€ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else {
          message = "ã¾ã ã¾ã ã“ã“ã‹ã‚‰ï¼ãƒ¬ãƒ™ãƒç›®æŒ‡ã—ã¦ãƒªãƒ™ãƒ³ã‚¸ğŸ”¥";
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ã€‚ã¾ã ã¾ã ã“ã“ã‹ã‚‰ï¼ãƒ¬ãƒ™ãƒç›®æŒ‡ã—ã¦ãƒªãƒ™ãƒ³ã‚¸ğŸ”¥ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        }
      }

      // çµæœè¡¨ç¤º
      let html = '';
      if (sogoLabel) {
        html += sogoLabel + '<br>';
      }
      if (message) {
        html += `<span style="font-size:1.1em;color:#1976d2;">${message}</span><br>`;
      }
      document.getElementById('result').innerHTML = html;

      // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæç”»
      const ctx = document.getElementById('radarChart').getContext('2d');
      if (chart) chart.destroy();
      // ã‚«ãƒ¼ãƒ‰è‰²ã¨åŒã˜è‰²ã‚’ãƒ©ãƒ™ãƒ«ã«é©ç”¨
      const labelColors = {
        'ç®¡ç†ä¼šè¨ˆè«–': '#e6a100', // æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸
        'è²¡å‹™ä¼šè¨ˆè«–': '#1976d2', // æ¿ƒã„é’
        'ç›£æŸ»è«–': '#0288d1', // æ¿ƒã„æ°´è‰²
        'ä¼æ¥­æ³•': '#bfa800', // æ¿ƒã„é»„è‰²
        'ç§Ÿç¨æ³•': '#8e24aa', // æ¿ƒã„ç´«
        'çµŒå–¶å­¦': '#388e3c' // æ¿ƒã„ç·‘
      };
      chart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: labels,
          datasets: [{
            label: 'åå·®å€¤',
            data: values,
            backgroundColor: 'rgba(0,123,255,0.2)',
            borderColor: 'rgba(0,123,255,1)',
            pointBackgroundColor: 'rgba(0,123,255,1)',
            pointRadius: 5,
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            r: {
              min: 20,
              max: 70,
              ticks: {
                stepSize: 10,
                color: '#666',
                font: { size: 12 }
              },
              pointLabels: {
                font: { size: 13 },
                color: function(context) {
                  const idx = context.index;
                  const label = context.chart.data.labels[idx];
                  return labelColors[label] || '#222';
                }
              }
            }
          }
        }
      });
      // ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³è¡¨ç¤º
      document.getElementById('tweetBtn').style.display = '';
    });

    // å…é™¤ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®åˆ¶å¾¡
    const menjoList = [
      { box: 'menjo-zaimu', msg: 'menjo-msg-zaimu', inputs: ['zaimu'] },
      { box: 'menjo-kanri', msg: 'menjo-msg-kanri', inputs: ['kanri'] },
      { box: 'menjo-kansa', msg: 'menjo-msg-kansa', inputs: ['kansa'] },
      { box: 'menjo-hou', msg: 'menjo-msg-hou', inputs: ['hou'] },
      { box: 'menjo-sozei', msg: 'menjo-msg-sozei', inputs: ['sozei'] },
      { box: 'menjo-sentaku', msg: 'menjo-msg-sentaku', inputs: ['sentaku'] }
    ];
    menjoList.forEach(({box, msg, inputs}) => {
      const cb = document.getElementById(box);
      const msgDiv = document.getElementById(msg);
      cb.addEventListener('change', function() {
        if (cb.checked) {
          msgDiv.style.display = '';
          inputs.forEach(id => {
            document.getElementById(id).disabled = true;
            document.getElementById(id).value = '';
          });
        } else {
          msgDiv.style.display = 'none';
          inputs.forEach(id => {
            document.getElementById(id).disabled = false;
          });
        }
      });
    });

    document.getElementById('tweetBtn').addEventListener('click', function() {
      const resultText = document.getElementById('result').textContent.trim();
      if (!resultText) {
        alert('å…ˆã«è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      // ç·åˆåå·®å€¤ã«å¿œã˜ãŸtweetTextã‚’å†ç”Ÿæˆ
      let tweetText = '';
      const sogoText = document.getElementById('result').textContent.match(/ç·åˆåå·®å€¤ï¼š([0-9.]+)/);
      let totalHensachi = sogoText ? Number(sogoText[1]) : null;
      if (totalHensachi !== null) {
        if (totalHensachi >= 65) {
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ï¼ï¼Ÿã‚„ã‚‹ã‚„ã‚“ï¼å¤©æ‰çˆ†èª•ï¼ï¼Ÿ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 60) {
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ï¼ã„ã„ã­ï¼ã“ã®ã¾ã¾çªã£èµ°ã‚Œï½ğŸ’¨ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 55) {
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ã€ã‚¸ãƒ¯ã‚¸ãƒ¯ãã¦ã‚‹ã€ãã®èª¿å­ğŸ”¥ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 52) {
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ï¼ã‚‚ã†ã²ã¨ä¼¸ã³ï¼æ¬¡ã®è‡ªåˆ†ã«æœŸå¾…ğŸ˜ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else if (totalHensachi >= 50) {
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ã€ãŠã—ã„ï¼ã‚ã¨ã¡ã‚‡ã£ã¨ã§ã‚¾ãƒ¼ãƒ³çªå…¥ğŸš€ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        } else {
          tweetText = `ç·åˆåå·®å€¤${totalHensachi}ã€‚ã¾ã ã¾ã ã“ã“ã‹ã‚‰ï¼ãƒ¬ãƒ™ãƒç›®æŒ‡ã—ã¦ãƒªãƒ™ãƒ³ã‚¸ğŸ”¥ #ä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—`;
        }
      } else {
        tweetText = resultText + '\n' + location.href + '\n#å…¬èªä¼šè¨ˆå£« #åå·®å€¤è¨ˆç®—';
      }
      // Xã‚¢ãƒ—ãƒªå„ªå…ˆã§é–‹ãintentã‚¹ã‚­ãƒ¼ãƒ 
      const tweet = encodeURIComponent(tweetText + '\n' + location.href);
      const xIntentUrl = `twitter://post?message=${tweet}`;
      setTimeout(() => {
        window.location.href = xIntentUrl;
        setTimeout(() => {
          window.open(`https://twitter.com/intent/tweet?text=${tweet}`, '_blank');
        }, 800);
      }, 100);
    });
  </script>
</body>
</html>
